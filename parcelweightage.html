<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Parcel QR Scanner</title>
<link rel="stylesheet" href="css/style.css"> <!-- same styling system as login -->
<style>
body {
    margin: 0;
    padding: 0;
    font-family: "Poppins", sans-serif;
    background: #f6f5f7; /* same as login */
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.container {
    width: 420px;
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    text-align: center;
}

h2 {
    font-size: 26px;
    margin-bottom: 10px;
    color: #ff4b2b; /* same orange-red from login */
}

p.small-title {
    color: #555;
    margin-bottom: 25px;
}

video {
    width: 100%;
    border-radius: 14px;
    background: black;
    margin-bottom: 12px;
}

label {
    font-size: 14px;
    font-weight: 600;
    display: block;
    text-align: left;
    margin-top: 10px;
    color: #333;
}

input {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    margin-top: 5px;
    background: #f3f3f3;
    font-size: 15px;
    color: #333;
}

button {
    width: 100%;
    padding: 14px;
    margin-top: 20px;
    background: #ff416c; 
    background: linear-gradient(to right, #ff4b2b, #ff416c);
    border: none;
    border-radius: 20px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
}
button:hover {
    opacity: 0.93;
}
</style>
</head>

<body>

<div class="container">
    <h2>Parcel Scanner</h2>
    <p class="small-title">Scan your QR and enter weight</p>

    <video id="camera" autoplay></video>
    <canvas id="qr-canvas" style="display:none;"></canvas>

    <label>Parcel QR Code</label>
    <input type="text" id="parcelID" readonly>

    <label>Phone Number</label>
    <input type="text" id="phoneNumber" placeholder="Enter phone number">

    <label>Parcel Weight (KG)</label>
    <input type="number" id="parcelWeight" placeholder="Enter weight">

    <button onclick="submitParcel()">Submit Parcel Info</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>

<script>
const video = document.getElementById("camera");
const canvas = document.getElementById("qr-canvas");
const ctx = canvas.getContext("2d");

let scanning = false;
let stream;

// Start camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
    .then(s => {
        stream = s;
        video.srcObject = s;
        scanning = true;
        scanLoop();
    });

// QR Scan Loop
function scanLoop() {
    if (!scanning) return;

    if (video.readyState === video.HAVE_ENOUGH_DATA) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(data.data, canvas.width, canvas.height);

        if (code) {
            document.getElementById("parcelID").value = code.data;
            stopCamera();
        }
    }

    requestAnimationFrame(scanLoop);
}

// Stop camera
function stopCamera() {
    scanning = false;
    if (stream) stream.getTracks().forEach(t => t.stop());
}

// Submit
function submitParcel() {
    let parcel = parcelID.value.trim();
    let phone = phoneNumber.value.trim();
    let weight = parseFloat(parcelWeight.value);

    if (!parcel || !phone || !weight) {
        alert("Please scan QR, enter phone number, and weight.");
        return;
    }

    // Weight logic
    let category = "";
    if (weight <= 2) category = "Small";
    else if (weight <= 5) category = "Medium";
    else category = "Large";

    // Redirect
    window.location.href = "storagelocation.html?weight=" + weight;
}
</script>

</body>
</html>
