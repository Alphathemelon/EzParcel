<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EZParcel – Scanner + Storage</title>
<link rel="stylesheet" href="css/style.css">
<style>
/* ===================== GLOBAL ===================== */
* {
    box-sizing: border-box;
}

body, html {
    margin: 0;
    padding: 0;
    font-family: "Poppins", sans-serif;
    background: #f6f5f7;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    overflow-x: hidden;
}

.hidden { display: none; }

/* ===================== CONTAINER ===================== */
.container {
    width: 100%;
    max-width: 420px;
    background: white;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    text-align: center;
    overflow-y: auto;
    max-height: 90vh; /* scroll if content too tall */
}

/* ===================== HEADINGS ===================== */
h2 {
    font-size: 26px;
    margin-bottom: 10px;
    color: #3454B4;
}

p.small-title {
    color: #555;
    margin-bottom: 20px;
}

/* ===================== FORM ELEMENTS ===================== */
video {
    width: 100%;
    max-height: 300px;
    border-radius: 14px;
    background: black;
    margin-bottom: 12px;
    object-fit: cover;
}

label {
    font-size: 14px;
    font-weight: 600;
    display: block;
    text-align: left;
    margin-top: 10px;
    color: #333;
}

input {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    margin-top: 5px;
    background: #f3f3f3;
    font-size: 15px;
    color: #333;
}

/* ===================== BUTTONS ===================== */
button {
    width: 100%;
    padding: 14px;
    margin-top: 20px;
    background: linear-gradient(to right, #3454B4, #2E3B99);
    border: none;
    border-radius: 20px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
}
button:hover { opacity: 0.93; }

/* ===================== STORAGE PAGE ===================== */
.storage-header {
    background: linear-gradient(to right,#3454B4,#2E3B99);
    padding: 20px;
    color: white;
    font-size: 22px;
    font-weight: bold;
    border-radius: 12px;
    margin-bottom: 20px;
}

/* ===================== GRID FOR SLOTS ===================== */
#gridContainer {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.slot {
    padding: 18px 0;
    border-radius: 12px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    text-align: center;
    color: white;
    transition: 0.2s;
}

.slot:hover {
    transform: scale(1.05);
}

.available { background: #28A745; }
.selected { background: #DC3545; }

/* ===================== CONFIRM BUTTON ===================== */
#confirmBtn {
    margin-top: 15px;
    background: linear-gradient(to right, #28A745, #1E7E34);
}
#confirmBtn:hover { opacity: 0.9; }
#confirmBtn:disabled { background: #ccc; cursor: not-allowed; }

@media (max-width: 480px) {
    .container {
        padding: 20px;
    }
    h2 { font-size: 22px; }
    .storage-header { font-size: 20px; padding: 15px; }
    .slot { font-size: 16px; padding: 14px 0; }
}
</style>
</head>
<body>

<!-- ============================ SCANNER PAGE ============================ -->
<div class="container" id="scannerPage">
    <h2>Parcel Scanner</h2>
    <p class="small-title">Scan your QR and enter weight</p>

    <video id="camera" autoplay></video>
    <canvas id="qr-canvas" style="display:none;"></canvas>

    <label>Parcel QR Code</label>
    <input type="text" id="parcelID" readonly>

    <label>Phone Number</label>
    <input type="text" id="phoneNumber" placeholder="Enter phone number">

    <label>Parcel Weight (KG)</label>
    <input type="number" id="parcelWeight" placeholder="Enter weight">

    <button onclick="submitParcel()">Submit Parcel Info</button>
</div>

<!-- ============================ STORAGE PAGE ============================ -->
<div class="container hidden" id="storagePage">
    <div class="storage-header" id="shelfTitle">Storage Location</div>
    <div id="gridContainer"></div>
    <button id="confirmBtn" onclick="confirmLocation()" disabled>Confirm Location</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
<script>
/* ===== QR SCANNER ===== */
const video = document.getElementById("camera");
const canvas = document.getElementById("qr-canvas");
const ctx = canvas.getContext("2d");

let scanning = false;
let stream;

function startCamera() {
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(s => {
            stream = s;
            video.srcObject = s;
            scanning = true;
            scanLoop();
        })
        .catch(err => console.error("Camera error:", err));
}

startCamera();

function scanLoop() {
    if (!scanning) return;
    if (video.readyState === video.HAVE_ENOUGH_DATA) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(data.data, canvas.width, canvas.height);
        if (code) {
            document.getElementById("parcelID").value = code.data;
            stopCamera();
        }
    }
    requestAnimationFrame(scanLoop);
}

function stopCamera() {
    scanning = false;
    if (stream) stream.getTracks().forEach(t => t.stop());
}

/* ===== SUBMIT PARCEL INFO ===== */
function submitParcel() {
    let parcel = parcelID.value.trim();
    let phone = phoneNumber.value.trim();
    let weight = parseFloat(parcelWeight.value);

    if (!parcel || !phone || !weight) {
        alert("Please scan QR, enter phone number, and weight.");
        return;
    }

    let shelf = "";
    if (weight <= 2) shelf = "SMALL – SHELF B";
    else if (weight <= 5) shelf = "MEDIUM – SHELF C";
    else shelf = "LARGE – SHELF D";

    document.getElementById("shelfTitle").innerText = shelf;
    document.getElementById("scannerPage").classList.add("hidden");
    document.getElementById("storagePage").classList.remove("hidden");

    generateSlots();
}

/* ===== GENERATE SLOT GRID ===== */
function generateSlots() {
    const container = document.getElementById("gridContainer");
    container.innerHTML = ""; 

    for (let i = 1; i <= 24; i++) {
        const num = i.toString().padStart(2, '0');
        const div = document.createElement("div");
        div.className = "slot available";
        div.textContent = num;

        div.onclick = () => {
            document.querySelectorAll(".slot.selected").forEach(s => s.classList.remove("selected"));
            div.classList.add("selected");
            updateConfirmButton();
        };

        container.appendChild(div);
    }
    updateConfirmButton();
}

function updateConfirmButton() {
    const anySelected = document.querySelectorAll(".slot.selected").length > 0;
    document.getElementById("confirmBtn").disabled = !anySelected;
}

function confirmLocation() {
    const selectedSlot = document.querySelector(".slot.selected").textContent;
    alert("Confirmed slot: " + selectedSlot);

    document.getElementById("storagePage").classList.add("hidden");
    document.getElementById("scannerPage").classList.remove("hidden");

    parcelID.value = "";
    phoneNumber.value = "";
    parcelWeight.value = "";

    startCamera();
}
</script>

</body>
</html>
